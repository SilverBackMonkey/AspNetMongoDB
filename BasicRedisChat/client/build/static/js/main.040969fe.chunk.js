(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{130:function(e,t,s){"use strict";s.r(t);s(68),s(69),s(70),s(71);var n=s(1),a=s(27),c=s.n(a),r=s(3),o=s(5),i=s(6),l=s.n(i),d=s(11),u=s(136),j=s(0),b=function(e){var t=e.width,s=void 0===t?64:t,n=e.height,a=void 0===n?64:n;return Object(j.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 32 32",height:a,width:s,children:[Object(j.jsx)("script",{}),Object(j.jsxs)("defs",{children:[Object(j.jsx)("path",{id:"prefix__a",d:"M45.536 38.764c-2.013 1.05-12.44 5.337-14.66 6.494s-3.453 1.146-5.207.308-12.85-5.32-14.85-6.276c-1-.478-1.524-.88-1.524-1.26v-3.813s14.447-3.145 16.78-3.982 3.14-.867 5.126-.14 13.853 2.868 15.814 3.587v3.76c0 .377-.452.8-1.477 1.324z"}),Object(j.jsx)("path",{id:"prefix__b",d:"M45.536 28.733c-2.013 1.05-12.44 5.337-14.66 6.494s-3.453 1.146-5.207.308-12.85-5.32-14.85-6.276-2.04-1.613-.077-2.382l15.332-5.935c2.332-.837 3.14-.867 5.126-.14s12.35 4.853 14.312 5.57 2.037 1.31.024 2.36z"})]}),Object(j.jsxs)("g",{transform:"matrix(.84833 0 0 .84833 -7.884 -9.45)",children:[Object(j.jsx)("use",{fill:"#a41e11",xlinkHref:"#prefix__a"}),Object(j.jsx)("path",{d:"M45.536 34.95c-2.013 1.05-12.44 5.337-14.66 6.494s-3.453 1.146-5.207.308-12.85-5.32-14.85-6.276-2.04-1.613-.077-2.382l15.332-5.936c2.332-.836 3.14-.867 5.126-.14S43.55 31.87 45.51 32.6s2.037 1.31.024 2.36z",fill:"#d82c20"}),Object(j.jsx)("use",{fill:"#a41e11",xlinkHref:"#prefix__a",y:-6.218}),Object(j.jsx)("use",{fill:"#d82c20",xlinkHref:"#prefix__b"}),Object(j.jsx)("path",{d:"M45.536 26.098c-2.013 1.05-12.44 5.337-14.66 6.495s-3.453 1.146-5.207.308-12.85-5.32-14.85-6.276c-1-.478-1.524-.88-1.524-1.26V21.55s14.447-3.145 16.78-3.982 3.14-.867 5.126-.14 13.853 2.868 15.814 3.587v3.76c0 .377-.452.8-1.477 1.324z",fill:"#a41e11"}),Object(j.jsx)("use",{fill:"#d82c20",xlinkHref:"#prefix__b",y:-6.449}),Object(j.jsxs)("g",{fill:"#fff",children:[Object(j.jsx)("path",{d:"M29.096 20.712l-1.182-1.965-3.774-.34 2.816-1.016-.845-1.56 2.636 1.03 2.486-.814-.672 1.612 2.534.95-3.268.34zM22.8 24.624l8.74-1.342-2.64 3.872z"}),Object(j.jsx)("ellipse",{cx:20.444,cy:21.402,rx:4.672,ry:1.811})]}),Object(j.jsx)("path",{d:"M42.132 21.138l-5.17 2.042-.004-4.087z",fill:"#7a0c00"}),Object(j.jsx)("path",{d:"M36.963 23.18l-.56.22-5.166-2.042 5.723-2.264z",fill:"#ad2115"})]})]})},m=(s(78),["Pablo","Joe","Mary","Alex"]);function f(e){var t=e.onLogIn,s=Object(n.useState)((function(){return m[Math.floor(Math.random()*m.length)]})),a=Object(o.a)(s,2),c=a[0],r=a[1],i=Object(n.useState)("password123"),f=Object(o.a)(i,2),O=f[0],p=f[1],x=Object(n.useState)(null),g=Object(o.a)(x,2),v=g[0],y=g[1],N=function(){var e=Object(d.a)(l.a.mark((function e(s){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s.preventDefault(),t(c,O,y);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(j.jsx)(j.Fragment,{children:Object(j.jsx)("div",{className:"login-form text-center login-page",children:Object(j.jsxs)("div",{className:"rounded",style:{boxShadow:"0 0.75rem 1.5rem rgba(18,38,63,.03)"},children:[Object(j.jsxs)("div",{className:"position-relative",children:[Object(j.jsxs)("div",{className:"row no-gutters align-items-center",style:{maxWidth:400,backgroundColor:"rgba(85, 110, 230, 0.25)",paddingLeft:20,paddingRight:20,borderTopLeftRadius:4,borderTopRightRadius:4},children:[Object(j.jsxs)("div",{className:"col text-primary text-left",children:[Object(j.jsx)("h3",{className:"font-size-15",children:"Welcome Back !"}),Object(j.jsx)("p",{children:"Sign in to continue"})]}),Object(j.jsx)("div",{className:"col align-self-end",children:Object(j.jsx)("img",{alt:"welcome back",style:{maxWidth:"100%"},src:"".concat("","/welcome-back.png")})})]}),Object(j.jsx)("div",{className:"position-absolute",style:{bottom:-36,left:20},children:Object(j.jsx)("div",{style:{backgroundColor:"rgb(239, 242, 247)",width:72,height:72},className:"rounded-circle d-flex align-items-center justify-content-center",children:Object(j.jsx)(b,{width:34,height:34})})})]}),Object(j.jsxs)("form",{className:"bg-white text-left px-4",style:{paddingTop:58,borderBottomLeftRadius:4,borderBottomRightRadius:4},onSubmit:N,children:[Object(j.jsx)("label",{className:"font-size-12",children:"Name"}),Object(j.jsx)("div",{className:"username-select mb-3",children:Object(j.jsx)(h,{username:c,setUsername:r,names:m})}),Object(j.jsx)("label",{htmlFor:"inputPassword",className:"font-size-12",children:"Password"}),Object(j.jsx)("input",{value:O,onChange:function(e){return p(e.target.value)},type:"password",id:"inputPassword",className:"form-control",placeholder:"Password",required:!0}),Object(j.jsx)("div",{style:{height:30}}),Object(j.jsx)("button",{className:"btn btn-lg btn-primary btn-block",type:"submit",children:"Sign in"}),Object(j.jsx)("div",{className:"login-error-anchor",children:Object(j.jsx)("div",{className:"toast-box",children:Object(j.jsxs)(u.a,{style:{minWidth:277},onClose:function(){return y(null)},show:null!==v,delay:3e3,autohide:!0,children:[Object(j.jsxs)(u.a.Header,{children:[Object(j.jsx)("img",{src:"holder.js/20x20?text=%20",className:"rounded mr-2",alt:""}),Object(j.jsx)("strong",{className:"mr-auto",children:"Error"})]}),Object(j.jsx)(u.a.Body,{children:v})]})})}),Object(j.jsx)("div",{style:{height:30}})]})]})})})}var h=function(e){var t,s=e.username,a=e.setUsername,c=e.names,r=void 0===c?[""]:c,i=Object(n.useState)(!1),l=Object(o.a)(i,2),d=l[0],u=l[1],b=Object(n.useState)(0),m=Object(o.a)(b,2),f=m[0],h=m[1],O=Object(n.useRef)(),p=null===(t=O.current)||void 0===t?void 0:t.getBoundingClientRect().width;return Object(n.useEffect)((function(){h(p)}),[p]),Object(n.useEffect)((function(){if(d){var e=function(){return u(!1)};return document.addEventListener("click",e),function(){return document.removeEventListener("click",e)}}}),[d]),Object(n.useEffect)((function(){var e;d&&(null===(e=O.current)||void 0===e||e.focus())}),[d]),Object(j.jsxs)("div",{tabIndex:0,ref:O,className:"username-select-dropdown ".concat(d?"open":""),onClick:function(){return u((function(e){return!e}))},children:[Object(j.jsxs)("div",{className:"username-select-row",children:[Object(j.jsx)("div",{children:s}),Object(j.jsx)("div",{children:Object(j.jsx)("svg",{width:24,height:24,children:Object(j.jsx)("path",{d:"M7 10l5 5 5-5z",fill:"#333"})})})]}),Object(j.jsx)("div",{style:{width:f},className:"username-select-block ".concat(d?"open":""),children:r.map((function(e){return Object(j.jsx)("div",{className:"username-select-block-item",onClick:function(){return a(e)},children:e},e)}))})]})},O=s(23),p=(s(81),s(14)),x=function(e,t){switch(t.type){case"clear":return{currentRoom:"0",rooms:{},users:{}};case"set user":return Object(r.a)(Object(r.a)({},e),{},{users:Object(r.a)(Object(r.a)({},e.users),{},Object(p.a)({},t.payload.id,t.payload))});case"make user online":return Object(r.a)(Object(r.a)({},e),{},{users:Object(r.a)(Object(r.a)({},e.users),{},Object(p.a)({},t.payload,Object(r.a)(Object(r.a)({},e.users[t.payload]),{},{online:!0})))});case"append users":return Object(r.a)(Object(r.a)({},e),{},{users:Object(r.a)(Object(r.a)({},e.users),t.payload)});case"set messages":return Object(r.a)(Object(r.a)({},e),{},{rooms:Object(r.a)(Object(r.a)({},e.rooms),{},Object(p.a)({},t.payload.id,Object(r.a)(Object(r.a)({},e.rooms[t.payload.id]),{},{messages:t.payload.messages,offset:t.payload.messages.length})))});case"prepend messages":var s=[].concat(Object(O.a)(t.payload.messages),Object(O.a)(e.rooms[t.payload.id].messages));return Object(r.a)(Object(r.a)({},e),{},{rooms:Object(r.a)(Object(r.a)({},e.rooms),{},Object(p.a)({},t.payload.id,Object(r.a)(Object(r.a)({},e.rooms[t.payload.id]),{},{messages:s,offset:s.length})))});case"append message":return void 0===e.rooms[t.payload.id]?e:Object(r.a)(Object(r.a)({},e),{},{rooms:Object(r.a)(Object(r.a)({},e.rooms),{},Object(p.a)({},t.payload.id,Object(r.a)(Object(r.a)({},e.rooms[t.payload.id]),{},{lastMessage:t.payload.message,messages:e.rooms[t.payload.id].messages?[].concat(Object(O.a)(e.rooms[t.payload.id].messages),[t.payload.message]):void 0})))});case"set last message":return Object(r.a)(Object(r.a)({},e),{},{rooms:Object(r.a)(Object(r.a)({},e.rooms),{},Object(p.a)({},t.payload.id,Object(r.a)(Object(r.a)({},e.rooms[t.payload.id]),{},{lastMessage:t.payload.lastMessage})))});case"set current room":return Object(r.a)(Object(r.a)({},e),{},{currentRoom:t.payload});case"add room":return Object(r.a)(Object(r.a)({},e),{},{rooms:Object(r.a)(Object(r.a)({},e.rooms),{},Object(p.a)({},t.payload.id,t.payload))});case"set rooms":var n=t.payload,a=Object(r.a)({},e.rooms);return n.forEach((function(e){a[e.id]=Object(r.a)(Object(r.a)({},e),{},{messages:a[e.id]&&a[e.id].messages})})),Object(r.a)(Object(r.a)({},e),{},{rooms:a});default:return e}},g={currentRoom:"main",rooms:{},users:{}},v=Object(n.createContext)(),y=function(){var e=Object(n.useContext)(v),t=Object(o.a)(e,2);return[t[0],t[1]]},N=function(){return Object(n.useReducer)(x,g)},w=s(21),k=s.n(w),M=s(12),C=s.n(M);C.a.defaults.withCredentials=!0;var L=function(e){return"".concat("").concat(e)},S=function(){return C.a.get(L("/users/me")).then((function(e){return e.data})).catch((function(e){return null}))},z=function(e){return C.a.get(L("/users"),{params:{ids:e||[]}}).then((function(e){return e.data}))},_=function(e,t){return C.a.post(L("/auth/login"),{username:e,password:t}).then((function(e){return e.data})).catch((function(e){throw new Error(e.response&&e.response.data&&e.response.data.message)}))},E=function(){return C.a.post(L("/auth/logout"))},R=function(){var e=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",C.a.get(L("/rooms/user/".concat(t))).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),I=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15;return C.a.get(L("/rooms/messages/".concat(e)),{params:{offset:t,size:s}}).then((function(e){return e.data.reverse()}))},B=function(){var e=Object(d.a)(l.a.mark((function e(t,s){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",C.a.post(L("/room"),{user1:t,user2:s}).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e)})));return function(t,s){return e.apply(this,arguments)}}(),F=s(63),U=function(e,t){var s,n=Object(F.a)(e);try{for(n.s();!(s=n.n()).done;){var a=s.value;if("string"!==typeof a&&(a=a[0]),a!==t)return a}}catch(c){n.e(c)}finally{n.f()}return e[0]},T=(s(131),function(){var e=Object(d.a)(l.a.mark((function e(t,s,n){var a,c,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a={},n.forEach((function(e){a[e.from]=1})),0===(c=Object.keys(a).filter((function(e){return void 0===t[e]}))).length){e.next=8;break}return e.next=6,z(c);case 6:r=e.sent,s({type:"append users",payload:r});case 8:case"end":return e.stop()}}),e)})));return function(t,s,n){return e.apply(this,arguments)}}()),H=function(){return Object(j.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 1651 1651",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[Object(j.jsx)("rect",{width:"1651",height:"1651",rx:"14",fill:"white"}),Object(j.jsx)("path",{d:"M495.286 1098.96L497.967 1070.86L478.04 1050.88C408.572 981.233 368 891.771 368 795.344C368 585.371 565.306 402 826 402C1086.69 402 1284 585.371 1284 795.344C1284 1005.32 1086.69 1188.69 826 1188.69V1248.69L825.913 1188.69C779.837 1188.75 733.952 1182.77 689.432 1170.9L667.26 1164.98L646.8 1175.37C620.731 1188.61 562.74 1213.98 467.32 1235.35C480.554 1191.83 490.95 1144.39 495.286 1098.96Z",stroke:"url(#paint0_linear)",strokeWidth:"120"}),Object(j.jsx)("defs",{children:Object(j.jsxs)("linearGradient",{id:"paint0_linear",x1:"662.312",y1:"397.956",x2:"416.164",y2:"1678.7",gradientUnits:"userSpaceOnUse",children:[Object(j.jsx)("stop",{stopColor:"#7514FB"}),Object(j.jsx)("stop",{offset:"0.624243",stopColor:"#F26D41"}),Object(j.jsx)("stop",{offset:"1",stopColor:"#F43B4B"})]})})]})},J=function(e){var t=e.name,s=e.id,a=Object(n.useMemo)((function(){var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"1",t=13,s=654,n=531,a=+e.split(":").pop(),c=+e.split(":").reverse().pop();c<0&&(c+=3555);var r=(a*s+c*n)%t;return"".concat("","/avatars/").concat(r,".jpg")}(""+s);return"Mary"===t?"".concat("","/avatars/0.jpg"):"Pablo"===t?"".concat("","/avatars/2.jpg"):"Joe"===t?"".concat("","/avatars/9.jpg"):"Alex"===t?"".concat("","/avatars/8.jpg"):e}),[s,t]);return Object(j.jsx)(j.Fragment,{children:"General"!==t?Object(j.jsx)("img",{src:a,alt:t,style:{width:32,height:32,objectFit:"cover"},className:"rounded-circle avatar-xs"}):Object(j.jsx)("div",{className:"overflow-hidden rounded-circle",children:Object(j.jsx)(H,{})})})},P=function(e){var t=e.online,s=e.hide,n=void 0!==s&&s,a=e.width,c=void 0===a?8:a,r=e.height,o=void 0===r?8:r;return Object(j.jsx)("div",{className:t?"rounded-circle bg-success":"rounded-circle bg-gray",style:{width:c,height:o,opacity:n?0:1}})},W=function(e){var t=e.id,s=e.name,a=y(),c=Object(o.a)(a,1)[0],r=Object(n.useMemo)((function(){try{var e=Math.abs(parseInt(t.split(":").reverse().pop())),n=e>0,a=Object.entries(c.users).filter((function(e){return Object(o.a)(e,2)[1].username===s})).map((function(e){return Object(o.a)(e,2)[1]})),r=!1;return a.length>0&&(r=a[0].online,e=+a[0].id),[n,r,e]}catch(i){return[!1,!1,"0"]}}),[t,s,c.users]),i=Object(o.a)(r,3),l=i[0],d=i[1],u=i[2],j=D(e);return{isUser:l,online:d,userId:u,name:e.name,lastMessage:j}},D=function(e){var t=y(),s=Object(o.a)(t,2)[1],a=e.lastMessage;return Object(n.useEffect)((function(){void 0===a&&(void 0===e.messages?I(e.id,0,1).then((function(t){var n=null;0!==t.length&&(n=t.pop()),s({type:"set last message",payload:{id:e.id,lastMessage:n}})})):0===e.messages.length?s({type:"set last message",payload:{id:e.id,lastMessage:null}}):s({type:"set last message",payload:{id:e.id,lastMessage:e.messages[e.messages.length-1]}}))}),[a,s,e]),a},A=function(e){var t=e.room,s=e.active,n=void 0!==s&&s,a=e.onClick,c=W(t),r=c.online,o=c.name,i=c.lastMessage,l=c.userId;return Object(j.jsxs)("div",{onClick:a,className:"chat-list-item d-flex align-items-start rounded ".concat(n?"bg-white":""),children:[Object(j.jsx)("div",{className:"align-self-center mr-3",children:Object(j.jsx)(P,{online:r,hide:"0"===t.id})}),Object(j.jsx)("div",{className:"align-self-center mr-3",children:Object(j.jsx)(J,{name:o,id:l})}),Object(j.jsxs)("div",{className:"media-body overflow-hidden",children:[Object(j.jsx)("h5",{className:"text-truncate font-size-14 mb-1",children:o}),i&&Object(j.jsxs)("p",{className:"text-truncate mb-0",children:[" ",i.message," "]})]}),i&&Object(j.jsx)("div",{className:"font-size-11",children:k.a.unix(i.date).format("LT")})]})},V=s(134),q=function(e){var t=e.onLogOut,s=e.col,n=void 0===s?5:s,a=e.noinfo,c=void 0!==a&&a;return Object(j.jsxs)("div",{onClick:t,style:{cursor:"pointer"},className:"col-".concat(n," text-danger ").concat(c?"":"text-right"),children:[Object(j.jsx)(V.a,{})," Log out"]})},G=function(e){var t=e.user,s=e.col,n=void 0===s?7:s,a=e.noinfo,c=void 0!==a&&a;return Object(j.jsxs)("div",{className:"col-".concat(n," d-flex align-items-center ").concat(c?"justify-content-end":""),children:[Object(j.jsx)("div",{className:"align-self-center ".concat(c?"":"mr-3"),children:Object(j.jsx)(J,{name:t.username,id:t.id})}),!c&&Object(j.jsxs)("div",{className:"media-body",children:[Object(j.jsx)("h5",{className:"font-size-14 mt-0 mb-1",children:t.username}),Object(j.jsxs)("div",{className:"d-flex align-items-center",children:[Object(j.jsx)(P,{online:!0}),Object(j.jsx)("p",{className:"ml-2 text-muted mb-0",children:"Active"})]})]})]})},X=function(e){var t=e.user,s=e.onLogOut;return Object(j.jsx)("div",{className:"row no-gutters align-items-center pl-4 pr-2 pb-3",style:{height:"inherit",flex:0,minHeight:50},children:Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(G,{user:t,col:8}),Object(j.jsx)(q,{onLogOut:s,col:4})]})})},Z=function(e){var t=e.rooms,s=e.dispatch,a=e.user,c=e.currentRoom,r=e.onLogOut,o=Object(n.useMemo)((function(){var e=Object.values(t),s=e.filter((function(e){return"0"===e.id})),n=e.filter((function(e){return"0"!==e.id}));return n=n.sort((function(e,t){return+e.id.split(":").pop()-+t.id.split(":").pop()})),[].concat(Object(O.a)(s||[]),Object(O.a)(n))}),[t]);return Object(j.jsx)(j.Fragment,{children:Object(j.jsxs)("div",{className:"chat-list-container flex-column d-flex pr-4",children:[Object(j.jsx)("div",{className:"py-2",children:Object(j.jsx)("p",{className:"h5 mb-0 py-1 chats-title",children:"Chats"})}),Object(j.jsx)("div",{className:"messages-box flex flex-1",children:Object(j.jsx)("div",{className:"list-group rounded-0",children:o.map((function(e){return Object(j.jsx)(A,{onClick:function(){return s({type:"set current room",payload:e.id})},active:c===e.id,room:e},e.id)}))})}),Object(j.jsx)(X,{user:a,onLogOut:r})]})})},K=function(e){var t=e.message;return Object(j.jsx)("p",{className:"mb-2 fs-6 fw-light fst-italic text-black-50 text-center",style:{opacity:.8,fontSize:14},children:t})},Q=function(){return Object(j.jsx)("div",{className:"no-messages flex-column d-flex flex-row justify-content-center align-items-center text-muted text-center",children:Object(j.jsx)("div",{className:"spinner-border",role:"status",children:Object(j.jsx)("span",{className:"visually-hidden"})})})},Y=s(135),$=function(){return Object(j.jsxs)("div",{className:"no-messages flex-column d-flex flex-row justify-content-center align-items-center text-muted text-center",children:[Object(j.jsx)(Y.a,{size:96}),Object(j.jsx)("p",{children:"No messages"})]})},ee=function(){return Object(j.jsxs)("svg",{width:12,height:12,className:"prefix__MuiSvgIcon-root prefix__jss80 prefix__MuiSvgIcon-fontSizeLarge",viewBox:"0 0 24 24","aria-hidden":"true",children:[Object(j.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),Object(j.jsx)("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"})]})},te=function(e){var t=e.username,s=void 0===t?"user":t,n=e.message,a=void 0===n?"Lorem ipsum dolor...":n,c=e.date;return Object(j.jsxs)("div",{className:"d-flex",children:[Object(j.jsx)("div",{style:{flex:1}}),Object(j.jsx)("div",{style:{width:"50%"},className:"text-right mb-4",children:Object(j.jsx)("div",{className:"conversation-list d-inline-block bg-light px-3 py-2",style:{borderRadius:12},children:Object(j.jsxs)("div",{className:"ctext-wrap",children:[Object(j.jsx)("div",{className:"conversation-name text-left text-primary mb-1",style:{fontWeight:600},children:s}),Object(j.jsx)("p",{className:"text-left",children:a}),Object(j.jsxs)("p",{className:"chat-time mb-0",children:[Object(j.jsx)(ee,{})," ",k.a.unix(c).format("LT")," "]})]})})})]})},se=function(e){var t=e.user,s=e.message,n=void 0===s?"Lorem ipsum dolor...":s,a=e.date,c=e.onUserClicked;return Object(j.jsxs)("div",{className:"d-flex",children:[Object(j.jsx)("div",{style:{width:"50%"},className:"text-left mb-4",children:Object(j.jsx)("div",{className:"conversation-list d-inline-block px-3 py-2",style:{borderRadius:12,backgroundColor:"rgba(85, 110, 230, 0.1)"},children:Object(j.jsxs)("div",{className:"ctext-wrap",children:[t&&Object(j.jsxs)("div",{className:"conversation-name text-primary d-flex align-items-center mb-1",children:[Object(j.jsx)("div",{className:"mr-2",style:{fontWeight:600,cursor:"pointer"},onClick:c,children:t.username}),Object(j.jsx)(P,{width:7,height:7,online:t.online})]}),Object(j.jsx)("p",{className:"text-left",children:n}),Object(j.jsxs)("p",{className:"chat-time mb-0",children:[Object(j.jsx)(ee,{})," ",k.a.unix(a).format("LT")," "]})]})})}),Object(j.jsx)("div",{style:{flex:1}})]})},ne=function(e){var t=e.messageListElement,s=e.messages,n=e.room,a=e.onLoadMoreMessages,c=e.user,r=e.onUserClicked,o=e.users;return Object(j.jsxs)("div",{ref:t,className:"chat-box-wrapper position-relative d-flex",children:[void 0===s?Object(j.jsx)(Q,{}):0===s.length?Object(j.jsx)($,{}):Object(j.jsx)(j.Fragment,{}),Object(j.jsx)("div",{className:"px-4 pt-5 chat-box position-absolute",children:s&&0!==s.length&&Object(j.jsxs)(j.Fragment,{children:[n.offset&&n.offset>=15?Object(j.jsxs)("div",{className:"d-flex flex-row align-items-center mb-4",children:[Object(j.jsx)("div",{style:{height:1,backgroundColor:"#eee",flex:1}}),Object(j.jsx)("div",{className:"mx-3",children:Object(j.jsx)("button",{"aria-haspopup":"true","aria-expanded":"true",type:"button",onClick:a,className:"btn rounded-button btn-secondary nav-btn",id:"__BVID__168__BV_toggle_",children:"Load more"})}),Object(j.jsx)("div",{style:{height:1,backgroundColor:"#eee",flex:1}})]}):Object(j.jsx)(j.Fragment,{}),s.map((function(e,t){var s=e.message+e.date+e.from+t;return"info"===e.from?Object(j.jsx)(K,{message:e.message},s):+e.from!==+c.id?Object(j.jsx)(se,{onUserClicked:function(){return r(e.from)},message:e.message,date:e.date,user:o[e.from]},s):Object(j.jsx)(te,{username:o[e.from]?o[e.from].username:"",message:e.message,date:e.date},s)}))]})})]})},ae=function(e){var t=e.message,s=e.setMessage,n=e.onSubmit;return Object(j.jsx)("div",{className:"p-3 chat-input-section",children:Object(j.jsxs)("form",{className:"row",onSubmit:n,children:[Object(j.jsx)("div",{className:"col",children:Object(j.jsx)("div",{className:"position-relative",children:Object(j.jsx)("input",{value:t,onChange:function(e){return s(e.target.value)},type:"text",placeholder:"Enter Message...",className:"form-control chat-input"})})}),Object(j.jsx)("div",{className:"col-auto",children:Object(j.jsxs)("button",{type:"submit",className:"btn btn-primary btn-rounded chat-send w-md",children:[Object(j.jsx)("span",{className:"d-none d-sm-inline-block mr-2",children:"Send"}),Object(j.jsx)("svg",{width:13,height:13,viewBox:"0 0 24 24",tabIndex:-1,children:Object(j.jsx)("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z",fill:"white"})})]})})]})})},ce=function(e){var t=y(),s=Object(o.a)(t,2),a=s[0],c=s[1],i=Object(n.useRef)(null),u=a.rooms[a.currentRoom],j=null===u||void 0===u?void 0:u.id,b=null===u||void 0===u?void 0:u.messages,m=Object(n.useState)(""),f=Object(o.a)(m,2),h=f[0],O=f[1],p=Object(n.useCallback)((function(){setTimeout((function(){i.current&&(i.current.scrollTop=0)}),0)}),[]),x=Object(n.useCallback)((function(){i.current&&i.current.scrollTo({top:i.current.scrollHeight})}),[]);Object(n.useEffect)((function(){x()}),[b,x]);var g=Object(n.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];I(j,e).then(function(){var e=Object(d.a)(l.a.mark((function e(s){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T(a.users,c,s);case 2:c({type:t?"prepend messages":"set messages",payload:{id:j,messages:s}}),t?setTimeout((function(){p()}),10):x();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[c,j,x,p,a.users]);Object(n.useEffect)((function(){void 0!==j&&void 0===b&&g()}),[b,c,j,a.users,a,x,g]),Object(n.useEffect)((function(){i.current&&x()}),[x,j]);var v=function(){var t=Object(d.a)(l.a.mark((function t(s){var n,o,i;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=a.users[s],void 0!==(o=n.room)){t.next=9;break}return t.next=5,B(s,e.id);case 5:i=t.sent,o=i.id,c({type:"set user",payload:Object(r.a)(Object(r.a)({},n),{},{room:o})}),c({type:"add room",payload:{id:o,name:U(i.names,e.username)}});case 9:c({type:"set current room",payload:o});case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return{onLoadMoreMessages:Object(n.useCallback)((function(){g(u.offset,!0)}),[g,u]),onUserClicked:v,message:h,setMessage:O,dispatch:c,room:u,rooms:a.rooms,currentRoom:a.currentRoom,messageListElement:i,roomId:j,users:a.users,messages:b}};function re(e){var t=e.onLogOut,s=e.user,n=e.onMessageSend,a=ce(s),c=a.onLoadMoreMessages,r=a.onUserClicked,o=a.message,i=a.setMessage,l=a.rooms,d=a.room,u=a.currentRoom,b=a.dispatch,m=a.messageListElement,f=a.roomId,h=a.messages,O=a.users;return Object(j.jsx)("div",{className:"container py-5 px-4",children:Object(j.jsxs)("div",{className:"chat-body row overflow-hidden shadow bg-light rounded",children:[Object(j.jsx)("div",{className:"col-4 px-0",children:Object(j.jsx)(Z,{user:s,onLogOut:t,rooms:l,currentRoom:u,dispatch:b})}),Object(j.jsxs)("div",{className:"col-8 px-0 flex-column bg-white rounded-lg",children:[Object(j.jsx)("div",{className:"px-4 py-4",style:{borderBottom:"1px solid #eee"},children:Object(j.jsx)("h2",{className:"font-size-15 mb-0",children:d?d.name:"Room"})}),Object(j.jsx)(ne,{messageListElement:m,messages:h,room:d,onLoadMoreMessages:c,user:s,onUserClicked:r,users:O}),Object(j.jsx)(ae,{message:o,setMessage:i,onSubmit:function(e){e.preventDefault(),n(o.trim(),f),i(""),m.current.scrollTop=m.current.scrollHeight}})]})]})})}function oe(){return Object(j.jsx)("div",{className:"centered-box",children:Object(j.jsx)("div",{className:"spinner-border",role:"status",children:Object(j.jsx)("span",{className:"visually-hidden"})})})}var ie=function(e){var t=e.link;return Object(j.jsx)("a",{href:t,target:"_blank",title:"Github",children:Object(j.jsxs)("svg",{width:24,height:24,viewBox:"0 0 64 64","aria-labelledby":"title","aria-describedby":"desc",role:"img",children:[Object(j.jsx)("path",{"data-name":"layer2",d:"M32 0a32.021 32.021 0 0 0-10.1 62.4c1.6.3 2.2-.7 2.2-1.5v-6c-8.9 1.9-10.8-3.8-10.8-3.8-1.5-3.7-3.6-4.7-3.6-4.7-2.9-2 .2-1.9.2-1.9 3.2.2 4.9 3.3 4.9 3.3 2.9 4.9 7.5 3.5 9.3 2.7a6.93 6.93 0 0 1 2-4.3c-7.1-.8-14.6-3.6-14.6-15.8a12.27 12.27 0 0 1 3.3-8.6 11.965 11.965 0 0 1 .3-8.5s2.7-.9 8.8 3.3a30.873 30.873 0 0 1 8-1.1 30.292 30.292 0 0 1 8 1.1c6.1-4.1 8.8-3.3 8.8-3.3a11.965 11.965 0 0 1 .3 8.5 12.1 12.1 0 0 1 3.3 8.6c0 12.3-7.5 15-14.6 15.8a7.746 7.746 0 0 1 2.2 5.9v8.8c0 .9.6 1.8 2.2 1.5A32.021 32.021 0 0 0 32 0z",fill:"#595F70"}),Object(j.jsx)("path",{"data-name":"layer1",d:"M12.1 45.9c-.1.2-.3.2-.5.1s-.4-.3-.3-.5.3-.2.6-.1c.2.2.3.4.2.5zm1.3 1.5a.589.589 0 0 1-.8-.8.631.631 0 0 1 .7.1.494.494 0 0 1 .1.7zm1.3 1.8a.585.585 0 0 1-.7-.3.6.6 0 0 1 0-.8.585.585 0 0 1 .7.3c.2.3.2.7 0 .8zm1.7 1.8c-.2.2-.5.1-.8-.1-.3-.3-.4-.6-.2-.8a.619.619 0 0 1 .8.1.554.554 0 0 1 .2.8zm2.4 1c-.1.3-.4.4-.8.3s-.6-.4-.5-.7.4-.4.8-.3c.3.2.6.5.5.7zm2.6.2c0 .3-.3.5-.7.5s-.7-.2-.7-.5.3-.5.7-.5c.4.1.7.3.7.5zm2.4-.4q0 .45-.6.6a.691.691 0 0 1-.8-.3q0-.45.6-.6c.5-.1.8.1.8.3z",fill:"#595F70"})]})})},le=function(){var e=Object(n.useState)(null),t=Object(o.a)(e,2),s=t[0],a=t[1];return Object(n.useEffect)((function(){C.a.get(L("/links")).then((function(e){return e.data})).catch((function(e){return null})).then(a)}),[]),Object(j.jsxs)("nav",{className:"navbar navbar-expand-lg navbar-light bg-white",children:[Object(j.jsx)("span",{className:"navbar-brand",children:"Redis chat demo"}),null!==s?Object(j.jsx)("span",{className:"navbar-text",children:s.github&&Object(j.jsx)(ie,{link:s.github})}):Object(j.jsx)(j.Fragment,{})]})},de=(s(100),s(65)),ue=function(e,t,s){t({type:"set user",payload:e}),void 0!==s&&t({type:"append message",payload:{id:"0",message:{date:1e4*Math.random(),from:"info",message:s}}})},je=function(){var e=N(),t=Object(o.a)(e,2),s=t[0],a=t[1],c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){},t=arguments.length>1?arguments[1]:void 0,s=Object(n.useState)(!0),a=Object(o.a)(s,2),c=a[0],r=a[1],i=Object(n.useState)(null),u=Object(o.a)(i,2),j=u[0],b=u[1],m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};s(null),n(!0),_(e,t).then((function(e){b(e),n(!1)})).catch((function(e){s(e.message),n(!1)}))},f=function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:E().then((function(){b(null),t({type:"clear"}),r(!0)}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)((function(){c&&S().then((function(t){b(t),r(!1),e(t)}))}),[e,c]),{user:"string"===typeof j?null:j,onLogIn:m,onLogOut:f,loading:c}}(Object(n.useCallback)((function(e){null!==e&&(s.users[e.id]||a({type:"set user",payload:Object(r.a)(Object(r.a)({},e),{},{online:!0})}))}),[a,s.users]),a),i=c.user,u=c.onLogIn,j=c.onLogOut,b=c.loading,m=function(e,t,s){var a=Object(n.useState)(!1),c=Object(o.a)(a,2),r=c[0],i=c[1],l=Object(n.useRef)(null),d=l.current;return Object(n.useEffect)((function(){null===e?null!==d&&l.current.stop().then((function(){l.current=null,i(!1)})):null===l.current&&(l.current=(new de.a).withUrl("/chat").build(),l.current.start().then((function(){i(!0)})))}),[e,d]),Object(n.useEffect)((function(){r&&e?(d.on("user.connected",(function(e){ue(e,t,"".concat(e.username," connected"))})),d.on("user.disconnected",(function(e){return ue(e,t,"".concat(e.username," left"))})),d.on("message",(function(e){e=JSON.parse(e),t({type:"make user online",payload:e.from}),t({type:"append message",payload:{id:void 0===e.roomId?"0":e.roomId,message:e}})}))):d&&(d.off("user.connected"),d.off("user.disconnected"),d.off("user.room"),d.off("message"))}),[r,e,t,d]),[{emit:function(t,s){return d.invoke("SendMessage",JSON.stringify(e),JSON.stringify(s)),{}}},!0,function(){s()}]}(i,a,j),f=Object(o.a)(m,3),h=f[0],O=f[1],p=f[2];Object(n.useEffect)((function(){if(null!==i)if(O){var e=[];Object.keys(s.rooms).forEach((function(t){var n=s.rooms[t];n.connected||e.push(Object(r.a)(Object(r.a)({},n),{},{connected:!0}))})),0!==e.length&&a({type:"set rooms",payload:e})}else{var t=[];Object.keys(s.rooms).forEach((function(e){var n=s.rooms[e];n.connected&&t.push(Object(r.a)(Object(r.a)({},n),{},{connected:!1}))})),0!==t.length&&a({type:"set rooms",payload:t})}}),[i,O,a,h,s.rooms,s.users]),Object(n.useEffect)((function(){0===Object.values(s.rooms).length&&null!==i&&(C.a.get(L("/users/online")).then((function(e){return e.data})).then((function(e){a({type:"append users",payload:e})})),R(i.id).then((function(e){var t=[];e.forEach((function(e){var s=e.id,n=e.names;t.push({id:s,name:U(n,i.username)})})),a({type:"set rooms",payload:t}),a({type:"set current room",payload:"0"})})))}),[a,s.rooms,i]);var x=Object(n.useCallback)((function(e,t){"string"===typeof e&&0!==e.trim().length&&(h||console.error("Couldn't send message"),h.emit("message",{roomId:t,message:e,from:i.id,date:k()(new Date).unix()}))}),[i,h]);return{loading:b,user:i,state:s,dispatch:a,onLogIn:u,onMessageSend:x,onLogOut:p}},be=function(){var e=je(),t=e.loading,s=e.user,n=e.state,a=e.dispatch,c=e.onLogIn,r=e.onMessageSend,o=e.onLogOut;if(t)return Object(j.jsx)(oe,{});var i=!s;return Object(j.jsx)(v.Provider,{value:[n,a],children:Object(j.jsxs)("div",{className:"full-height ".concat(i?"bg-light":""),style:{backgroundColor:i?void 0:"#495057"},children:[Object(j.jsx)(le,{}),i?Object(j.jsx)(f,{onLogIn:c}):Object(j.jsx)(re,{user:s,onMessageSend:r,onLogOut:o})]})})};c.a.render(Object(j.jsx)(be,{}),document.getElementById("root"))},69:function(e,t,s){},70:function(e,t,s){},71:function(e,t,s){},78:function(e,t,s){},81:function(e,t,s){}},[[130,1,2]]]);
//# sourceMappingURL=main.040969fe.chunk.js.map